{% load static %}

<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{% block title %}{{ article.titre }} | Mon Journal{% endblock %}</title>

  <!-- Favicon -->
  <link rel="icon" href="{% static 'images/favicon.ico' %}" type="image/x-icon">

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@300;700&family=Montserrat:wght@600&display=swap" rel="stylesheet">

  <!-- CSS principal -->
  <link rel="stylesheet" href="{% static 'css/styles.css' %}">

  <!-- Swiper CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.css"/>
  <!-- Swiper JS -->
  <script src="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.js"></script>

  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="article" />
  <meta property="og:title" content="{{ article.titre }}" />
  <meta property="og:description" content="{{ article.contenu|truncatechars:150|striptags }}" />
  <meta property="og:url" content="{{ request.build_absolute_uri }}" />
  {% if article.image %}
    <meta property="og:image" content="{{ article.image.url }}" />
  {% else %}
    <meta property="og:image" content="https://picsum.photos/1200/600?random=1" />
  {% endif %}
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="{{ article.titre }}" />
  <meta name="twitter:description" content="{{ article.contenu|truncatechars:150|striptags }}" />
  {% if article.image %}
    <meta name="twitter:image" content="{{ article.image.url }}" />
  {% else %}
    <meta name="twitter:image" content="https://picsum.photos/1200/600?random=1" />
  {% endif %}

  {% block extra_css %}{% endblock %}
</head>

<body class="bg-white text-gray-800">

  {% include "partials/header.html" %}
{% if messages %}
<div class="flex justify-center mt-4">
  <div class="w-full max-w-xl space-y-3">
    {% for message in messages %}
      {% if message.tags == "success" %}
        <div class="bg-green-100 border border-green-300 text-green-700 px-4 py-3 rounded-lg text-center">
          {{ message }}
        </div>
      {% elif message.tags == "error" %}
        <div class="bg-red-100 border border-red-300 text-red-700 px-4 py-3 rounded-lg text-center">
          {{ message }}
        </div>
      {% elif message.tags == "warning" %}
        <div class="bg-yellow-100 border border-yellow-300 text-yellow-700 px-4 py-3 rounded-lg text-center">
          {{ message }}
        </div>
      {% else %}
        <div class="bg-blue-100 border border-blue-300 text-blue-700 px-4 py-3 rounded-lg text-center">
          {{ message }}
        </div>
      {% endif %}
    {% endfor %}
  </div>
</div>
{% endif %}
<!-- Bloquer clic droit, sélection et Ctrl+C -->




  <main class="max-w-7xl mx-auto px-4 py-8">
    <script>
    const socket = new WebSocket(
        "ws://" + window.location.host + "/ws/articles/"
    );

    socket.onmessage = function(e) {
        const data = JSON.parse(e.data);
        alert(data.message); // Ici, tu pourrais ajouter dynamiquement l’article au DOM
    };
</script>
    {% block content %}{% endblock %}
  </main>

  {% include "partials/footer.html" %}
<script src="{% static 'js/script.js' %}"></script>
<script src="{% static 'js/caroussel.js' %}"></script>
<script src="{% static 'js/monter.js' %}"></script>
<script>
    const protocol = window.location.protocol === "https:" ? "wss://" : "ws://";
    const socket = new WebSocket(
        protocol + window.location.host + "/ws/articles/"
    );

    socket.onmessage = function(e) {
        const data = JSON.parse(e.data);
        alert(data.message);
        // Ici, tu pourrais aussi créer dynamiquement un <div> ou une <li> dans la page
    };

    socket.onclose = function(e) {
        console.error("WebSocket fermé de façon inattendue");
    };
</script>

</body>
</html>
